Subject: Fix dependency declarations to fix concurrent builds
Author: Robie Basak <robie.basak@canonical.com>
Bug-Ubuntu: https://bugs.launchpad.net/bugs/978862
Forwarded: https://sourceforge.net/tracker/?func=detail&aid=3516878&group_id=16077&atid=316077
Last-Update: 2012-04-11

---
 src/libicalss/CMakeLists.txt   |    5 ++---
 src/libicalvcal/CMakeLists.txt |    3 +++
 2 files changed, 5 insertions(+), 3 deletions(-)

--- a/src/libicalvcal/CMakeLists.txt
+++ b/src/libicalvcal/CMakeLists.txt
@@ -30,6 +30,9 @@ endif(MSVC)
 add_library(icalvcal ${LIBRARY_TYPE} ${icalvcal_LIB_SRCS})
 add_library(icalvcal-static STATIC ${icalvcal_LIB_SRCS})
 
+add_dependencies(icalvcal ical-header)
+add_dependencies(icalvcal-static ical-header)
+
 target_link_libraries(icalvcal ical)
 
 if(MSVC)
--- a/src/libicalss/CMakeLists.txt
+++ b/src/libicalss/CMakeLists.txt
@@ -23,9 +23,7 @@ add_custom_command(
     -DICAL_FILE_H_FILE:FILEPATH=${CMAKE_BINARY_DIR}/src/libicalss/icalss.h
     -P ${CMAKE_CURRENT_SOURCE_DIR}/icalss_file.cmake
   DEPENDS
-  ${CMAKE_BINARY_DIR}/src/libical/icalderivedproperty.h
-  ${CMAKE_BINARY_DIR}/src/libical/icalderivedparameter.h
-  ${CMAKE_BINARY_DIR}/src/libical/icalderivedvalue.h
+  ical-header
 )
 
 add_custom_target(icalss-header DEPENDS
@@ -73,6 +71,7 @@ add_library(icalss ${LIBRARY_TYPE} ${ica
 add_library(icalss-static STATIC ${icalss_LIB_SRCS})
 
 add_dependencies(icalss icalss-header)
+add_dependencies(icalss-static icalss-header)
 
 target_link_libraries(icalss ical)
 
